---
- name: "Include {{ ansible_os_family }}.yml"
  include_vars: "{{ ansible_os_family }}.yml"

- name: "Include install-{{ ansible_os_family }}.yml"
  include: "install-{{ ansible_os_family }}.yml"

- name: Create fab_manager_group
  group:
    name: "{{ fab_manager_group }}"

- name: Create fab_manager_user
  user:
    name: "{{ fab_manager_user }}"
    group: "{{ fab_manager_group }}"
    home: "{{ fab_manager_home }}"

- name: Install fab_manager via git
  git:
    accept_hostkey: yes
    clone: yes
    depth: 1
    dest: "{{ fab_manager_repo_dir }}"
    repo: "{{ fab_manager_repo_url }}"
    version: "{{ fab_manager_repo_version }}"
  become: yes
  become_user: "{{ fab_manager_user }}"

- name: Create .env file
  template:
    src: env.j2
    dest: "{{ fab_manager_repo_dir }}/.env"
    validate: sh -n %s
    owner: "{{ fab_manager_user }}"
    group: "{{ fab_manager_group }}"
    mode: "0640"
